<?php
# -*- coding: utf-8 -*-

/**
 * Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð½Ð¾Ð²Ð¾Ð¹ Ð»Ð¾Ð³Ð¸ÐºÐ¸ Ð¿Ñ€Ð¸Ð²ÑÐ·ÐºÐ¸ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¹
 */

// ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ñ… ÐºÐ»Ð°ÑÑÐ¾Ð²
require_once __DIR__ . '/src/classes/EnvLoader.php';
require_once __DIR__ . '/src/classes/Logger.php';
require_once __DIR__ . '/src/classes/LocalStorage.php';

// Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
$config = require_once __DIR__ . '/src/config/bitrix24.php';

// Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð²
$logger = new Logger($config);
$localStorage = new LocalStorage($logger);

echo "=== Ð¢Ð•Ð¡Ð¢Ð˜Ð ÐžÐ’ÐÐÐ˜Ð• ÐŸÐ Ð˜Ð’Ð¯Ð—ÐšÐ˜ ÐšÐžÐœÐŸÐÐÐ˜Ð™ ===\n\n";

echo "ðŸ” Ð¢Ð•ÐšÐ£Ð©ÐÐ¯ Ð›ÐžÐ“Ð˜ÐšÐ:\n";
echo "â€¢ ÐšÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ñ Ð¿Ñ€Ð¸Ð²ÑÐ·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ðº Ð›Ðš Ñ‡ÐµÑ€ÐµÐ· CONTACT_ID\n";
echo "â€¢ Ð•ÑÐ»Ð¸ CONTACT_ID ÐµÑÑ‚ÑŒ - ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ Ð›Ðš ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð°\n";
echo "â€¢ Ð•ÑÐ»Ð¸ CONTACT_ID Ð½ÐµÑ‚ - Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ðµ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ\n\n";

// ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ… ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¹
$testCompanies = [
    [
        'ID' => '1001',
        'TITLE' => 'ÐšÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ñ Ñ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð¾Ð¼',
        'CONTACT_ID' => '2',  // Ð•ÑÑ‚ÑŒ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚ Ð•Ð³Ð¾Ñ€ Ð¤Ñ€Ð¾Ð»Ð¾Ð²
        'EMAIL' => [['VALUE' => 'company1@example.com']],
        'PHONE' => [['VALUE' => '+7 999 111-11-11']]
    ],
    [
        'ID' => '1002',
        'TITLE' => 'ÐšÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ñ Ð±ÐµÐ· ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð°',
        'CONTACT_ID' => null,  // ÐÐµÑ‚ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð°
        'EMAIL' => [['VALUE' => 'company2@example.com']],
        'PHONE' => [['VALUE' => '+7 999 222-22-22']]
    ],
    [
        'ID' => '1003',
        'TITLE' => 'ÐšÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ñ Ñ Ð½ÐµÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¼ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð¾Ð¼',
        'CONTACT_ID' => '9999',  // ÐÐµÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚
        'EMAIL' => [['VALUE' => 'company3@example.com']],
        'PHONE' => [['VALUE' => '+7 999 333-33-33']]
    ]
];

echo "ðŸ§ª Ð¡Ð˜ÐœÐ£Ð›Ð¯Ð¦Ð˜Ð¯ ÐžÐ‘Ð ÐÐ‘ÐžÐ¢ÐšÐ˜ ÐšÐžÐœÐŸÐÐÐ˜Ð™:\n\n";

foreach ($testCompanies as $company) {
    echo "ðŸ¢ ÐšÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ñ: {$company['TITLE']} (ID: {$company['ID']})\n";

    $contactId = $company['CONTACT_ID'];
    if (!empty($contactId)) {
        $contact = $localStorage->getContact($contactId);
        if ($contact) {
            echo "   âœ… Ð•ÑÑ‚ÑŒ CONTACT_ID: {$contactId} â†’ ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚: {$contact['name']} {$contact['last_name']}\n";
            echo "   ðŸ“¤ Ð‘ÑƒÐ´ÐµÑ‚ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð° Ñ Ð›Ðš ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð°\n";
        } else {
            echo "   âš ï¸  Ð•ÑÑ‚ÑŒ CONTACT_ID: {$contactId}, Ð½Ð¾ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ð² Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ñ…Ñ€Ð°Ð½Ð¸Ð»Ð¸Ñ‰Ðµ\n";
            echo "   ðŸš« Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½Ð°\n";
        }
    } else {
        echo "   ðŸ“ ÐÐµÑ‚ CONTACT_ID - Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ðµ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ\n";
    }
    echo "---\n";
}

echo "\nðŸ“‹ Ð’Ð«Ð’ÐžÐ”:\n";
echo "ÐšÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ð¿Ñ€Ð¸Ð²ÑÐ·Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ Ðº Ð›Ðš Ñ‡ÐµÑ€ÐµÐ· CONTACT_ID ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð°,\n";
echo "Ð° Ð½Ðµ Ð¿Ð¾ ÑÐ¾Ð±ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð¼Ñƒ bitrix_id. Ð­Ñ‚Ð¾ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¸ Ð³Ñ€ÑƒÐ¿Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ\n";
echo "ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸ Ð¿Ð¾ Ð¸Ñ… ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð½Ñ‹Ð¼ Ð»Ð¸Ñ†Ð°Ð¼ Ð² ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð›Ðš.\n";

echo "\nÐ¢ÐµÑÑ‚ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½.\n";
?>
