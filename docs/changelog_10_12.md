# Changelog — 10.12.2025

Подробные изменения относительно предыдущего коммита (`8ba4728`).

## Обработка вебхуков и API
- `src/classes/Bitrix24API.php`: гибкая валидация User-Agent, автоопределение формата тела (JSON/URL-encoded) при отсутствующем Content-Type, мягкая проверка `application_token`, проверка обязательного `event`, лимитированный лог с превью тела. Нормализация фильтров (`filter` / `select`) и логика для множественных запросов.
- Логирование успешных операций переведено в DEBUG для снижения шума; предупреждения и ошибки оставлены для ключевых сбоев.
- `src/webhooks/bitrix24.php`: добавлены проверки наличия конфига и доступности каталога логов; ограничение тела запроса 10 МБ с ответом 413; расширенные ответы об ошибках; рекомендации по ретраям без блокирующего `sleep` (ретраи — задачей внешней очереди).

## Локальное хранилище
- `src/classes/LocalStorage.php`: принимает конфиг, сохраняет статусы агентского/партнерского договоров, поддерживает множественные системные типы проектов, техническое описание, структурированный перечень оборудования; хранит телефоны/фото/мессенджеры менеджеров; добавлены методы удаления компаний/сделок.

## Конфигурация и маппинг
- `src/config/bitrix24.php`: актуализированы маппинги для проектов (system_types[], equipment_list, competitors, marketing_discount, technical_description) и договоров (агентский/партнерский).

## Интерфейс ЛК
- `index.php`: вынесена загрузка данных контакта в `loadContactData`; автоматический рендер полей пропускает служебные и списочные маппинги; подхват расширенных данных проектов/компаний/менеджеров.

## Скрипты
- `src/scripts/test_sync.php`: синхронизация учитывает новые поля проектов и менеджеров.
- `src/scripts/test_smart_process_cards.php`: корректный порядок аргументов конструктора `LocalStorage`, использование новых маппингов смарт-процессов.

## Документация
- Обновлен `README.md` под новую валидацию вебхуков, расширенные поля и тестовые скрипты.
- Удален пустой файл `docs/bitrix24_plan.txt`.
- Сохранены актуальные файлы в `docs/`: `INTEGRATION_SUMMARY.md`, `fields_analysis.md`, `data_types_processing.md`, `changelog_projects_fields.md`, `project_fields_integration_check.md`, `smart_process_usage.md`.

## Примечания по логированию
- INFO оставлен для ключевых статусов (начало/ошибка обработки), DEBUG — для структурных данных запросов/ответов.

