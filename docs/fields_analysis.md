# Анализ полей по ТЗ

## 1. КОНТАКТ (Contact) в Bitrix24

### Поля, упомянутые в ТЗ:

#### Обязательные поля (раздел 3):
- **Фамилия** (`LAST_NAME`) - ✅ используется в конфиге
- **Имя** (`NAME`) - ✅ используется в конфиге  
- **Организация** - ❌ НЕ найдено в конфиге (упоминается в п.3.2 ТЗ)
- **E-mail** (`EMAIL`) - ✅ используется в конфиге (используется как логин, п.7.4)
- **Телефон** (`PHONE`) - ✅ используется в конфиге
- **Ответственный** (`ASSIGNED_BY_ID`) - ✅ используется в конфиге как `manager_id`

#### Поле для управления ЛК:
- **ЛК клиента** (`UF_CRM_1763531846040`) - ✅ используется в конфиге как `lk_client_field`
  - Значения: Нет, Инсталлятор/интегратор, Торговый дом, Проектировщик

#### Поля для блока "Личные данные" (п.3.6):
- Данные берутся из карточки контакта
- **Статус "Агентский договор"** - ❌ НЕ найдено в конфиге

#### Поля для изменения (раздел 8):
- **E-mail** - можно изменить (п.8.2)
- **Телефон** - можно изменить (п.8.2)
- **Причина изменения данных** - ❌ НЕ найдено в конфиге (п.8.2)

---

## 2. КОМПАНИЯ (Company) в Bitrix24

### Поля, упомянутые в ТЗ:

#### Обязательные поля (раздел 3.7):
- **Название компании** (`TITLE`) - ✅ используется в конфиге
- **E-mail компании** (`EMAIL`) - ✅ используется в конфиге
- **Телефон компании** (`PHONE`) - ✅ используется в конфиге
- **Статус "Партнерский договор"** - ❌ НЕ найдено в конфиге

#### Поля для изменения (раздел 8.6):
- **Название компании** - можно изменить
- **ИНН** - ❌ НЕ найдено в конфиге (п.8.6)
- **Сайт компании** - ❌ НЕ найдено в конфиге (п.8.6)
- **Телефон компании** - можно изменить
- **Причина изменения данных о компании** - ❌ НЕ найдено в конфиге (п.8.6)

---

## 3. СОТРУДНИК/МЕНЕДЖЕР (User) в Bitrix24

### Поля, упомянутые в ТЗ (раздел 3.3):

- **Фамилия ответственного менеджера** (`LAST_NAME`) - ✅ используется в конфиге
- **Имя ответственного менеджера** (`NAME`) - ✅ используется в конфиге
- **Почта ответственного менеджера** (`EMAIL`) - ✅ используется в конфиге
- **Телефон ответственного менеджера** (`PERSONAL_PHONE`) - ✅ используется в конфиге

---

## 4. СМАРТ-ПРОЦЕСС "Изменение данных в ЛК"

### Поля, упомянутые в ТЗ (раздел 8.9):

- **Контакт** - связь с контактом
- **Компания** (если есть) - связь с компанией
- **Ответственный менеджер** - связь с менеджером
- **Новый e-mail** - ❌ НЕ найдено в конфиге
- **Новый телефон** - ❌ НЕ найдено в конфиге
- **Причина изменения личных данных** - ❌ НЕ найдено в конфиге
- **Название новой компании** - ❌ НЕ найдено в конфиге
- **Сайт новой компании** - ❌ НЕ найдено в конфиге
- **ИНН новой компании** - ❌ НЕ найдено в конфиге
- **Телефон новой компании** - ❌ НЕ найдено в конфиге
- **Причина изменения данных о компании** - ❌ НЕ найдено в конфиге

**Примечание:** Смарт-процесс "Изменение данных в ЛК" не настроен в конфиге. Есть только смарт-процесс для проектов (ID: 1036).

---

## 5. СМАРТ-ПРОЦЕСС "Удаление пользовательских данных"

### Поля, упомянутые в ТЗ (раздел 10.5):

- **Контакт** - связь с контактом
- **Компания** (если есть) - связь с компанией
- **Ответственный менеджер** - связь с менеджером

**Примечание:** Смарт-процесс "Удаление пользовательских данных" не настроен в конфиге.

---

## 6. ПРОЕКТ (Smart Process) - Регистрация проектов

### Поля, используемые в коде:

- **Название организации конечного заказчика** (`ufCrm6_1758957874`) - ✅ используется
- **Название/тип объекта** (`ufCrm6_1758958190`) - ✅ используется
- **Состав оборудования из спецификации проекта** (`ufCrm6_1758959081`) - ✅ используется
- **Адрес объекта** (`ufCrm6_1758958310`) - ✅ используется
- **Дата реализации проекта** (`ufCrm6_1758959105`) - ✅ используется
- **Тип запросов** (`ufCrm6_1764840201124`) - ✅ используется (добавлено 04.12.2025)
- **Перечень оборудования** (`ufCrm6_1764840244682`) - ✅ используется (добавлено 04.12.2025, файл)
- **Возможные конкуренты** (`ufCrm6_1764840292955`) - ✅ используется (добавлено 04.12.2025)
- **Маркетинговая скидка** (`ufCrm6_1764840330293`) - ✅ используется (добавлено 04.12.2025, чекбокс)
- **Статус** (`stageId`) - ✅ используется
- **Связь с клиентом** (`contactId`) - ✅ используется

---

## ИТОГОВАЯ СВОДКА

### ✅ Реализованные поля:
- Контакт: Фамилия, Имя, E-mail, Телефон, Ответственный, ЛК клиента, Организация (через COMPANY_ID)
- Компания: Название, E-mail, Телефон, ИНН, Сайт компании (WEB)
- Менеджер: Фамилия, Имя, E-mail, Телефон
- Проект: Все основные поля

### ⚠️ Частично реализованные поля (требуют уточнения кодов полей в Bitrix24):

#### Контакт:
1. **Статус "Агентский договор"** (п.3.6) - добавлено в конфиг, но требуется уточнить код поля в Б24

#### Компания:
1. **Статус "Партнерский договор"** (п.3.7) - добавлено в конфиг, но требуется уточнить код поля в Б24

#### Смарт-процессы:
1. **Смарт-процесс "Изменение данных в ЛК"** - добавлена структура полей в конфиг
   - ✅ Базовые поля (контакт, компания, менеджер)
   - ⚠️ Все остальные поля требуют уточнения кодов в Б24:
     - Новый e-mail, Новый телефон
     - Причина изменения личных данных
     - Название новой компании, Сайт новой компании, ИНН новой компании, Телефон новой компании
     - Причина изменения данных о компании
   - ⚠️ Требуется уточнить ID смарт-процесса в Б24

2. **Смарт-процесс "Удаление пользовательских данных"** - добавлена структура полей в конфиг
   - ✅ Все поля добавлены (контакт, компания, менеджер)
   - ⚠️ Требуется уточнить ID смарт-процесса в Б24

---

## СТАТУС РЕАЛИЗАЦИИ

### ✅ Выполнено:
1. ✅ Добавлено поле "Организация" в маппинг контакта (через COMPANY_ID)
2. ✅ Добавлены поля "ИНН" и "Сайт компании" в маппинг компании
3. ✅ Добавлена структура смарт-процессов для изменения и удаления данных
4. ✅ Добавлены заготовки для полей статусов (требуют уточнения кодов)

### ⚠️ Требуется уточнение в Bitrix24:
1. Код поля "Статус Агентский договор" для контакта
2. Код поля "Статус Партнерский договор" для компании
3. ID смарт-процесса "Изменение данных в ЛК"
4. ID смарт-процесса "Удаление пользовательских данных"
5. Коды всех полей в смарт-процессе "Изменение данных в ЛК" (новый e-mail, новый телефон, причины и т.д.)

---

## СЛЕДУЮЩИЕ ШАГИ

1. В Bitrix24 найти и указать коды полей для статусов договоров
2. Создать или найти смарт-процессы "Изменение данных в ЛК" и "Удаление пользовательских данных" в Б24
3. Указать ID созданных смарт-процессов в конфиге
4. Указать коды всех полей в смарт-процессах в конфиге
5. Реализовать логику создания карточек в смарт-процессах при изменении/удалении данных

